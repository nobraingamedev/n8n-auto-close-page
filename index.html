<!DOCTYPE html>
<html lang="en">
<head>
  <title>Form Submitted Successfully</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, var(--tg-theme-bg-color, #f0f2f5) 0%, var(--tg-theme-secondary-bg-color, #e8eef3) 100%);
      color: var(--tg-theme-text-color, #1a1a1a);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: relative;
      overflow: hidden;
    }

    .container {
      background: var(--tg-theme-bg-color, #ffffff);
      border-radius: 24px;
      padding: 48px 32px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      border: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.05));
      max-width: 400px;
      width: 90%;
      transform: translateY(0);
      animation: slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      backdrop-filter: blur(10px);
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(40px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .success-icon {
      font-size: 72px;
      margin-bottom: 24px;
      display: inline-block;
      animation: bounce 0.8s ease-out 0.3s both;
      filter: drop-shadow(0 4px 8px rgba(76, 175, 80, 0.2));
    }

    @keyframes bounce {
      0%, 20%, 53%, 80%, 100% {
        transform: translate3d(0,0,0) scale(1);
      }
      40%, 43% {
        transform: translate3d(0,-8px,0) scale(1.1);
      }
      70% {
        transform: translate3d(0,-4px,0) scale(1.05);
      }
      90% {
        transform: translate3d(0,-2px,0) scale(1.02);
      }
    }

    h1 {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 12px;
      background: linear-gradient(135deg, var(--tg-theme-text-color, #1a1a1a), var(--tg-theme-hint-color, #666));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1.2;
    }

    .subtitle {
      font-size: 16px;
      color: var(--tg-theme-hint-color, #666);
      margin-bottom: 8px;
      font-weight: 500;
    }

    .countdown {
      font-size: 14px;
      color: var(--tg-theme-hint-color, #888);
      margin-bottom: 32px;
      opacity: 0.8;
    }

    .close-btn {
      background: linear-gradient(135deg, var(--tg-theme-button-color, #007AFF) 0%, var(--tg-theme-button-color, #0056CC) 100%);
      color: var(--tg-theme-button-text-color, #ffffff);
      border: none;
      padding: 16px 32px;
      border-radius: 16px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 8px 24px rgba(0, 122, 255, 0.3);
      position: relative;
      overflow: hidden;
      min-width: 140px;
    }

    .close-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .close-btn:hover::before {
      left: 100%;
    }

    .close-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(0, 122, 255, 0.4);
    }

    .close-btn:active {
      transform: translateY(0);
      box-shadow: 0 4px 16px rgba(0, 122, 255, 0.3);
    }

    .progress-bar {
      width: 100%;
      height: 3px;
      background: var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
      border-radius: 2px;
      overflow: hidden;
      margin-top: 24px;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--tg-theme-button-color, #007AFF), var(--tg-theme-button-color, #00D4FF));
      border-radius: 2px;
      width: 0%;
      animation: progress 2s linear;
    }

    @keyframes progress {
      from { width: 100%; }
      to { width: 0%; }
    }

    .background-decoration {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      opacity: 0.03;
      background-image: radial-gradient(circle at 20% 80%, var(--tg-theme-button-color, #007AFF) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, var(--tg-theme-button-color, #007AFF) 0%, transparent 50%);
    }

    @media (max-width: 480px) {
      .container {
        padding: 36px 24px;
        border-radius: 16px;
      }
      
      .success-icon {
        font-size: 60px;
      }
      
      h1 {
        font-size: 24px;
      }
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      body {
        background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
      }
      
      .container {
        background: rgba(42, 42, 42, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
    }
  </style>
</head>
<body>
  <div class="background-decoration"></div>
  
  <div class="container">
    <div class="success-icon">✅</div>
    <h1>Successfully Submitted!</h1>
    <p class="subtitle">Your form has been processed successfully</p>
    <p class="countdown" id="countdown">This window will close in <span id="timer">2</span> seconds</p>
    
    <button class="close-btn" onclick="closeWebApp()" id="closeBtn">
      Close Now
    </button>
    
    <div class="progress-bar">
      <div class="progress-fill"></div>
    </div>
  </div>

  <script>
    let countdownTimer = 2;
    let intervalId;

    function updateCountdown() {
      const timerElement = document.getElementById('timer');
      const countdownElement = document.getElementById('countdown');
      
      if (countdownTimer > 0) {
        timerElement.textContent = countdownTimer;
        countdownTimer--;
      } else {
        clearInterval(intervalId);
        countdownElement.textContent = 'Closing now...';
        closeWebApp();
      }
    }

    function closeWebApp() {
      // Clear any running intervals
      if (intervalId) {
        clearInterval(intervalId);
      }

      // Visual feedback
      const btn = document.getElementById('closeBtn');
      btn.textContent = 'Closing...';
      btn.style.opacity = '0.7';

      // Check if we're in Telegram Web App
      if (window.Telegram && window.Telegram.WebApp) {
        try {
          window.Telegram.WebApp.close();
          return;
        } catch (e) {
          console.log('Telegram WebApp close failed:', e);
        }
      }

      // Try multiple close methods
      attemptClose();
    }
    
    function attemptClose() {
      // Method 1: Standard window.close()
      if (window.opener || window.parent !== window) {
        try {
          window.close();
          return;
        } catch (e) {
          console.log('window.close() failed:', e);
        }
      }

      // Method 2: Try to go back in history
      if (history.length > 1) {
        try {
          history.back();
          return;
        } catch (e) {
          console.log('history.back() failed:', e);
        }
      }

      // Method 3: Try parent window communication
      try {
        if (window.parent && window.parent !== window) {
          window.parent.postMessage({ action: 'close' }, '*');
        }
      } catch (e) {
        console.log('postMessage failed:', e);
      }

      // Method 4: Replace content with manual close instruction
      setTimeout(() => {
        document.body.innerHTML = `
          <div style="text-align: center; padding: 40px; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
            <div style="background: white; padding: 40px; border-radius: 24px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); max-width: 400px;">
              <div style="font-size: 60px; margin-bottom: 20px;">✅</div>
              <h1 style="margin-bottom: 16px; color: #1a1a1a;">Form Submitted Successfully!</h1>
              <p style="color: #666; margin-bottom: 16px;">Your form has been processed.</p>
              <p style="color: #888; font-size: 14px;">Please close this tab or window manually.</p>
            </div>
          </div>
        `;
      }, 500);
    }
    
    // Initialize the page
    function init() {
      // Initialize Telegram Web App if available
      if (window.Telegram && window.Telegram.WebApp) {
        try {
          window.Telegram.WebApp.ready();
          window.Telegram.WebApp.expand();
        } catch (e) {
          console.log('Telegram WebApp initialization failed:', e);
        }
      }

      // Start countdown
      intervalId = setInterval(updateCountdown, 1000);
      
      // Add keyboard support
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' || e.key === 'Enter' || e.key === ' ') {
          closeWebApp();
        }
      });

      // Listen for messages from parent window
      window.addEventListener('message', function(event) {
        if (event.data && event.data.action === 'close') {
          closeWebApp();
        }
      });
    }

    // Start everything when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>
